# Virtual assembly file
# Test variable declarations, labels and all available commands

.STACK = 1024

.DATA

# Variables section
CHAR var;
CHAR var
CHAR var;

CHAR str1[] = "Hello World!"
CHAR ch1 = 'A'

BYTE bVal1;

BYTE bVal0
BYTE bVal1 = 1
BYTE bVal2 = 255
BYTE bVal3[] = 0x4F,0x0F
BYTE bVal4[10] = 10,20,30,40,50,60,70,80,90,0xF0

WORD wVal1;

WORD wVal1
WORD wVal2 = 10000
WORD wVal3 = 0x0100
WORD wVal4[5] = 100,200,300,400

DWORD dwVal1 = -1
DWORD dwVal2 = 10000000
DWORD dwVal3 = 0xA0B0C0D0
DWORD dwVal4[5]
DWORD dwVal5[4] = 0, 100, 0, 0xAAAAAAAA

QWORD qwVal1 = -10
QWORD qwVal2 = 10000000000
QWORD qwVal3 = 0x1080A0B0C0D0E0F0
QWORD qwVal4[5]
QWORD qwVal5 = 0xFFFFFFFFFFFFFFFF
QWORD qwVal6 = 0x8000000000000000
QWORD qwVal7[4] = 0, 0xFFFF, 0, 188900967592960

.CODE

Func F1;
Func F2;

Func Main:
	PUSHSF
	JUMP start
	NOP
	NOP
	NOP
start:
	MOVI A0, 0x000000A0
	MOVI A3, F1
	CALL A3
	MOVI A0, F2
	PUSH QW R0
	CALL A0
	POPSF
	RET
EndF

Func F1 :
	#MOVI QW R32,0x0F0E0D0C0B0A0908
	MOVI DW R40,0x01020304
	MOVI W R40,0x1020
	MOVI B R40,0x01
	MOVI R16, 10000

	MOVE R20, R0 
	MOVE B R20, R0 
	MOVE W R20, R0 
	MOVE DW R20, R0 
	MOVE QW R24, R0 
	               
	SWAP R20, R28 
	SWAP B R20, R28 
	SWAP W R20, R28 
	SWAP DW R20, R28 
	SWAP QW R16, R24 

Label1:
	AND R32,R8
	AND B  R32,R8
	AND W  R32,R8
	AND DW R32,R8
	AND QW R32,R8

	JZ Label2

	ADD R32,R8
	ADD B  R32,R8
	ADD W  R32,R8
	ADD DW R32,R8
	ADD QW R32,R8

Label2:
	PUSH R0
	POP R28
	PUSH B R0
	POP B R28
	PUSH W R0
	POP W R28
	PUSH DW R0
	POP DW R28
	PUSH QW R0
	POP QW R24
	GETF R16
	SETF R16

	RET
EndF

Func F2:	#156	
	PUSHSF 0x10	#0
	INC A0, R0	#4
	INC A0, 16	#8
	DEC A3, 10	#12
	DEC A2, R4	#16

	STAE W R16	#20
	NOT  W R16	#24

	MOVI B R63, 4	#28
	SHL W R36, 5	#32
	SHR W R36, R1	#36
	ROL W R36, 7	#40
	ROR W R36, R1	#44
	SAL W R36, 3	#48
	SAR W R36, R1	#52
	RCL W R36, 1	#56
	RCR W R36, R1	#60

	ADC R48, R32	#64
	SBB R48, R32	#68
	MUL R48, R32	#72
	IMUL R48, R32	#76
	DIV R48, R32	#80
	IDIV R48, R32	#84
	NEG QW R48		#88

	CAST W DW R24	#92
	CAST DW W R16	#96

	MOVI A0,bVal1 #100
	MOVI A1,wVal1 #106
	MOVI A2,dwVal1 #112
	MOVI A3,qwVal1 #118

	LOAD B R40,A0	#124
	LOAD W R40,A1	#128
	LOAD DW R40,A2	#132
	LOAD QW R40,A3	#136

	STORE B R40,A0	#140
	STORE W R40,A1	#144
	STORE DW R40,A2	#148
	STORE QW R40,A3	#152

	LDREL A2, SP, +10 #156
	STREL A2, SP, -10 #164

	MOVI R0, 2
	OUT R0,4		#172
	OUT W R40,8		#176
Loop:
	IN R44,4		#180
	IN W R44,8		#184
	BREAK			#188
	MOV R24, R0		#190
	CMP R24, R44	#196
	JNE Loop		#200

	TEST R0,R0		#204
	JZ Exit			#208
	BREAK			#212

Exit:
	POPSF 8			#214
	RET				#218
EndF				#220

.MAIN = Main
